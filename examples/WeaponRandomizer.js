// Author: Yum (Razz#3533)

const Player = new NativeClass('Terraria', 'Player');
const Item = new NativeClass('Terraria', 'Item');
const PrefixID = new NativeClass('Terraria.ID', 'PrefixID');
const Main = new NativeClass('Terraria', 'Main');

const SetDefaults = Item['void SetDefaults(int Type)'];

const prefixCount = () => PrefixID.Count;

let timerGiveItem = Main.GameUpdateCount;

const random = (max) => Math.floor(Math.random() * max);

const randomPrefix = () => random(prefixCount());

const randomWeapon = () => {
  const phItemID = random(PRE_HARDMODE.length);
  const hItemID = random(HARDMODE.length);
  
  if (Main.hardMode) {
    return HARDMODE[hItemID];
  }
  
  return PRE_HARDMODE[phItemID];
}

const PRE_HARDMODE = [
  3507,
  3501,
  24,
  2745,
  3508,
  6,
  2517,
  656,
  881,
  3495,
  3513,
  3502,
  653,
  4,
  921,
  3489,
  3519,
  3496,
  3514,
  1827,
  3490,
  1304,
  3520,
  3483,
  3772,
  3352,
  486,
  3484,
  946,
  186,
  4463,
  1166,
  1909,
  2273,
  724,
  46,
  4707,
  155,
  3349,
  198,
  199,
  200,
  201,
  202,
  203,
  4258,
  795,
  65,
  989,
  2330,
  1123,
  2608,
  190,
  121,
  273,
  3278,
  3285,
  3279,
  3280,
  3281,
  3262,
  3317,
  3282,
  280,
  277,
  4061,
  802,
  2332,
  274,
  284,
  55,
  1918,
  1825,
  4764,
  670,
  191,
  4818,
  119,
  1325,
  5011,
  5012,
  162,
  801,
  163,
  220,
  4144,
  39,
  2747,
  3504,
  2515,
  658,
  3498,
  655,
  99,
  923,
  3492,
  3510,
  3496,
  3516,
  3480,
  44,
  796,
  4381,
  2888,
  3019,
  120,
  1870,
  95,
  96,
  800,
  266,
  2269,
  98,
  964,
  4703,
  164,
  219,
  930,
  281,
  986,
  1319,
  3350,
  160,
  197,
  3069,
  4062,
  739,
  740,
  741,
  742,
  743,
  744,
  3377,
  64,
  113,
  157,
  112,
  218,
  4347,
  127,
  1121,
  165,
  1313,
  272,
  1256,
  4281,
  1309,
  2364,
  4273,
  2365,
  4672,
  4913
];

const HARDMODE = [
  659,
  3351,
  3258,
  483,
  1185,
  3764,
  3765,
  3766,
  3767,
  3768,
  3769,
  4259,
  1306,
  3823,
  484,
  1192,
  426,
  672,
  676,
  482,
  723,
  1199,
  3013,
  3211,
  368,
  674,
  1227,
  1327,
  3106,
  671,
  1226,
  1826,
  1928,
  675,
  3018,
  3827,
  4923,
  757,
  2880,
  3065,
  3063,
  3315,
  3316,
  3283,
  3290,
  3289,
  3284,
  3286,
  3287,
  3288,
  3291,
  3292,
  3389,
  537,
  1186,
  390,
  1193,
  406,
  1200,
  550,
  3836,
  1228,
  756,
  2331,
  1947,
  3030,
  4760,
  561,
  1324,
  1122,
  1513,
  2424,
  1314,
  4272,
  3012,
  389,
  1259,
  1297,
  2611,
  3368,
  4788,
  3054,
  4790,
  3835,
  1571,
  4789,
  1569,
  3858,
  3543,
  3473,
  4956,
  661,
  682,
  725,
  3029,
  3052,
  3854,
  2223,
  3859,
  2624,
  4953,
  3540,
  435,
  1187,
  436,
  1194,
  481,
  1201,
  578,
  1229,
  1835,
  434,
  2270,
  534,
  3788,
  905,
  1265,
  533,
  1255,
  679,
  1254,
  1782,
  1929,
  2797,
  3475,
  1553,
  758,
  760,
  759,
  3107,
  1258,
  1784,
  1946,
  3546,
  2796,
  3930,
  3210,
  3007,
  3008,
  506,
  1156,
  1910,
  4060,
  3787,
  3209,
  1264,
  726,
  3051,
  3006,
  2750,
  1308,
  495,
  683,
  3852,
  2188,
  788,
  1801,
  1931,
  1445,
  1444,
  1446,
  1930,
  1296,
  3870,
  514,
  4348,
  1155,
  1178,
  1260,
  1295,
  2795,
  2882,
  2623,
  519,
  1336,
  518,
  1266,
  2622,
  496,
  3014,
  1244,
  517,
  3269,
  3779,
  3053,
  4270,
  494,
  3105,
  4952,
  4715,
  3476,
  3542,
  3541,
  4758,
  2551,
  2584,
  4269,
  2535,
  3249,
  1157,
  1802,
  4607,
  2621,
  5005,
  2749,
  3474,
  3531,
  2366,
  1572,
  3569,
  3571,
  4912,
  4911,
  4678,
  4680,
  4679,
  4914
];

Player.Update.hook((original, self, i) => {
  original(self, i);
  const item = self.inventory[0];
  
  if (Main.GameUpdateCount - timerGiveItem > 900) {
    timerGiveItem = Main.GameUpdateCount;
    SetDefaults(item, randomWeapon());
    item.Prefix(randomPrefix());
  }
});